### 1.2 dispatcher
>提供tcp服务，缓存gate列表，game列表，以及entity属于哪个gameId
>server模式，提供给game和dispatcher连接


注意：

* 从client也就是gate来的消息，要做下缓存，而是不是直接退给game,方便game的热更新
* dispatcher的tick也是5ms，首先处理子线程回主线程的回调，然后发送game缓存信息。dispatcher的任务就是gate与game的代理和服务发现，因此越快越好
* 从game来的往gate去的消息，直接发送

```mermaid

graph TB
    a[dispatcher.main]-->b[dispatcherService.run]
    b-.注册回调.->c[netutil.ServeTCPForever]
    c-.启动tcp服务.->d0[net.listen]
    d0-.回调.->d[dispatcherService.ServeTCPConnection]
    d-->d1[dispatcherClientProxy]
    d1-->d2[GoWorldConnection]
    d2-.RecvChan写入.->e[dcp.owner.messageQueue]
    a-->b2[主线程service.messageLoop]
    b2-.循环读取.->e
    e-.从client到game.->e1[MT_SYNC_POSITION_YAW_FROM_CLIENT]
    e1-->f1[dispatcherService.handleSyncPositionYawFromClient]
    f1-.缓存入.->g1[dispatcherService.entitySyncInfosToGame]
    e-.属性变更.->e2[MT_NOTIFY_MAP_ATTR_CHANGE_ON_CLIENT]
    e2-->f2[dispatcherService.handleDoSomethingOnSpecifiedClient]
    e-->f[service.handleCreateEntitySomewhere]
    f-->g[调用game新建entity]


```

### 问题

1. dispatcher集群之间如何通信？

考虑dispatcher使用服务发现consul，game也可以考虑，

client接入gate，由gate决策dispatcher的负载，一旦分配，就不再变更。

2. dispatcher如何发现game,并找到匹配的game?

game连接dispatcher之后会给dispatcher发送消息MT_SET_GAME_ID，告知dispatcher连接客户端和gameId。

dispatcher.handleSetGameID 处理

MT_SET_GAME_ID能获得连接对象，与gameId关联存入dispatcher缓存，供dispatcher选择合适的连接对象，转发消息。

game会定时发gameLbcInfo发送给dispatcher，dispatcher缓存起来，作为分配game的依据。


3. dispatcher如何game的断开与重连？